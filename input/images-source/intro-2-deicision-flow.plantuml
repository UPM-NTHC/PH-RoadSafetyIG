@startuml
start
:EMS POST Bundle.runreport;
if (Gateway validates?) then (Yes)
  :Store Bundle, index by Incident No.;
  if (Does EMS update the run report later?) then (Yes)
    :EMS POST updated Bundle.runreport\nwith same Encounter.identifier;
  else (No)
    -[#green]-> :Done;
  endif
  if (Is cancellation needed?) then (Yes)
    :EMS POST Task or Bundle with cancel flag;
  else (No)
    -[#green]-> :Done;
  endif
  stop
else (No)
  :Return OperationOutcome 4xx/422;
  stop
endif
@enduml