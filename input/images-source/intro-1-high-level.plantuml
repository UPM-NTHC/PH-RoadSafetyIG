@startuml
title Road Safety Data Exchange - High-Level Overview
skinparam actorStyle awesome
skinparam roundcorner 20
box "Scene to Facility" #White
actor EMS
collections Gateway as "Health Data Gateway"
actor EHR as "Facility EHR"
database ETL as "ONEISS API"
end box
participant DPWH as "DPWH/DOTr"
participant HC as "Health Center"

note over Gateway
Central gateway (ONEISS / NHDR)
Routes, checks, and shares records
Supports Subscription delivery to ETL
end note

note right of EMS
Scene capture:
- Incident/Encounter
- Patient
- Vitals & notes
- Run Report form/attachments
end note

group Scene to EMS Transport Reporting
EMS -> Gateway : Send Run Report\n(Incident + Patient + Vitals + Attachments)
Gateway --> EMS : Confirm receipt\n(Incident reference)
end

note over EHR
Prefill triage and handoff using
incident and vitals from EMS
end note

group Facility [Retrieval]
    EHR -> Gateway : Retrieve Incident & Patient Summary
    Gateway --> EHR : Provide Summary\n(Encounter + Patient snapshot)
else Submission
    EHR -> Gateway : Share Facility Care Update\n(Triage, diagnoses, procedures)
    Gateway --> EHR : Update confirmed
end

group ONEISS ETL (optional)
    Gateway -> ETL : Subscription notification (POST /notifications)\n Transform to ONEISS compatible data
else Alternative
    Gateway -> ETL : Scheduled push of reports in ONEISS Compatible Data
    Gateway -> ETL : Or Manual export of reports
end

group Agency Reporting
DPWH <-> Gateway : Request Agency Report
Gateway --> DPWH : Provide Report\n(Required reporting fields)
end

group Follow-up Care
HC -> Gateway : Request Patient/Encounter for follow-up
Gateway --> HC : Provide Care Continuity Data
end

legend left
Key concepts
- Encounter connects EMS scene and Facility care
- Patient identity is shared across systems
- Observations & Documents add clinical detail
- Organization identifies EMS, Facilities, and Agencies
- ETL can subscribe/pull/transform data for reporting
endlegend

@enduml