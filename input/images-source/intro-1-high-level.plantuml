@startuml
title Road Safety Data Exchange - High-Level Overview
skinparam actorStyle awesome
skinparam roundcorner 20
box "Scene to Facility" #White
actor EMS
collections FHIR as "FHIR Server"
actor EHR as "Facility EHR"
database ETL as "ONEISS API"
end box
participant DPWH as "DPWH/DOTr"
participant HC as "Health Center"

note over FHIR
Central FHIR Server (ONEISS / NHDR)
Routes, checks, and shares records
Supports Subscription delivery to ETL
end note

note right of EMS
Scene capture:
- Incident/Encounter
- Patient
- Vitals & notes
- Run Report form/attachments
end note

group Scene to EMS Transport Reporting
EMS -> FHIR : Send Run Report\n(Incident + Patient + Vitals + Attachments)
FHIR --> EMS : Confirm receipt\n(Incident reference)
end

note over EHR
Prefill triage and handoff using
incident and vitals from EMS
end note

group Facility [Retrieval]
    EHR -> FHIR : Retrieve Incident & Patient Summary
    FHIR --> EHR : Provide Summary\n(Encounter + Patient snapshot)
else Submission
    EHR -> FHIR : Share Facility Care Update\n(Triage, diagnoses, procedures)
    FHIR --> EHR : Update confirmed
end

group ONEISS ETL (optional)
    FHIR -> ETL : Subscription notification (POST /notifications)\n Transform to ONEISS compatible data
else Alternative
    FHIR -> ETL : Scheduled push of reports in ONEISS Compatible Data
    FHIR -> ETL : Or Manual export of reports
end

group Agency Reporting
DPWH <-> FHIR : Request Agency Report
FHIR --> DPWH : Provide Report\n(Required reporting fields)
end

group Follow-up Care
HC -> FHIR : Request Patient/Encounter for follow-up
FHIR --> HC : Provide Care Continuity Data
end

legend left
Key concepts
- Encounter connects EMS scene and Facility care
- Patient identity is shared across systems
- Observations & Documents add clinical detail
- Organization identifies EMS, Facilities, and Agencies
- ETL can subscribe/pull/transform data for reporting
endlegend

@enduml